package com.example.oneuiapp;

import android.content.SharedPreferences;
import android.graphics.Color;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;
import android.widget.Switch;
import android.widget.SeekBar;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.appcompat.app.AppCompatDelegate;
import androidx.core.widget.NestedScrollView;

/**
 * ูุฑุงุฌููุช ูุญุณู ููุฅุนุฏุงุฏุงุช ุจุงุณุชุฎุฏุงู ููููุงุช Samsung One UI ุงููุชูุฏูุฉ
 * 
 * ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ:
 * - ูุงุฌูุฉ ุฅุนุฏุงุฏุงุช ุดุงููุฉ ูุน ุชุตููู One UI
 * - ุญูุธ ูุงุณุชุฑุฏุงุฏ ุงูุฅุนุฏุงุฏุงุช ูู SharedPreferences
 * - ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ ููุนุฑุถ ูุงูุชูุงุนู
 * - ุฃุฒุฑุงุฑ ุชุญูู ูุญุณูุฉ ุจุฃููุงู Samsung
 * - ูุคุดุฑุงุช ุงูุชูุฏู ูุงูุชุจุฏูู ุงููุชุทูุฑุฉ
 * - ุชุฎุทูุท ูุงุจู ููุชูุฑูุฑ ูุงุณุชูุนุงุจ ุฅุนุฏุงุฏุงุช ูุซูุฑุฉ
 */
public class SettingsFragment extends Fragment {
    
    // ููุงุชูุญ ุญูุธ ุงูุฅุนุฏุงุฏุงุช
    private static final String PREFS_NAME = "OneUIAppPrefs";
    private static final String KEY_DARK_MODE = "dark_mode_enabled";
    private static final String KEY_NOTIFICATIONS = "notifications_enabled";
    private static final String KEY_SOUND_VOLUME = "sound_volume";
    private static final String KEY_ANIMATION_SPEED = "animation_speed";
    private static final String KEY_LANGUAGE = "app_language";
    
    // ูุฑุงุฌุน ููููููุงุช
    private SharedPreferences sharedPrefs;
    private Switch darkModeSwitch;
    private Switch notificationSwitch;
    private SeekBar volumeSeekBar;
    private SeekBar animationSeekBar;
    private TextView volumeValueText;
    private TextView animationValueText;
    
    // ุฃููุงู One UI ุงููููุฒุฉ
    private static final int ONEUI_BLUE = Color.parseColor("#1976D2");
    private static final int ONEUI_SURFACE = Color.parseColor("#F5F5F5");
    private static final int ONEUI_ON_SURFACE = Color.parseColor("#1C1C1C");

    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, 
                           @Nullable Bundle savedInstanceState) {
        
        // ุชููุฆุฉ SharedPreferences
        initializePreferences();
        
        // ุฅูุดุงุก ุงูุชุฎุทูุท ุงููุญุณู ุจุฏูุงู ูู XML ูุนูุฏ
        NestedScrollView scrollView = createScrollableLayout();
        
        // ุฅุถุงูุฉ ุฌููุน ุฃูุณุงู ุงูุฅุนุฏุงุฏุงุช
        LinearLayout mainLayout = createMainSettingsLayout();
        scrollView.addView(mainLayout);
        
        // ุชุญููู ุงูุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ
        loadSavedSettings();
        
        return scrollView;
    }

    /**
     * ุชููุฆุฉ ูุธุงู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจุงุณุชุฎุฏุงู SharedPreferences
     * ูุถูู ุญูุธ ุฌููุน ุงุฎุชูุงุฑุงุช ุงููุณุชุฎุฏู ุจูู ุฌูุณุงุช ุงูุชุทุจูู
     */
    private void initializePreferences() {
        sharedPrefs = requireContext().getSharedPreferences(PREFS_NAME, 0);
    }

    /**
     * ุฅูุดุงุก ุชุฎุทูุท ูุงุจู ููุชูุฑูุฑ ูุงุณุชูุนุงุจ ุฌููุน ุงูุฅุนุฏุงุฏุงุช
     * ูุณุชุฎุฏู NestedScrollView ููุชูุงูู ูุน ููุชุจุงุช SESL
     */
    private NestedScrollView createScrollableLayout() {
        NestedScrollView scrollView = new NestedScrollView(requireContext());
        scrollView.setLayoutParams(new ViewGroup.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.MATCH_PARENT));
        scrollView.setFillViewport(true);
        scrollView.setPadding(dpToPx(16), dpToPx(16), dpToPx(16), dpToPx(16));
        
        return scrollView;
    }

    /**
     * ุฅูุดุงุก ุงูุชุฎุทูุท ุงูุฑุฆูุณู ูุฌููุน ุฃูุณุงู ุงูุฅุนุฏุงุฏุงุช
     * ููุธู ุงูุฅุนุฏุงุฏุงุช ูู ูุฌููุนุงุช ููุทููุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู
     */
    private LinearLayout createMainSettingsLayout() {
        LinearLayout mainLayout = new LinearLayout(requireContext());
        mainLayout.setOrientation(LinearLayout.VERTICAL);
        mainLayout.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));

        // ุฅุถุงูุฉ ุนููุงู ุงูุตูุญุฉ
        mainLayout.addView(createPageTitle());
        mainLayout.addView(createSectionSpacer());
        
        // ูุณู ุงููุธูุฑ ูุงูุนุฑุถ
        mainLayout.addView(createDisplaySection());
        mainLayout.addView(createSectionSpacer());
        
        // ูุณู ุงูุตูุช ูุงูุฅุดุนุงุฑุงุช
        mainLayout.addView(createSoundSection());
        mainLayout.addView(createSectionSpacer());
        
        // ูุณู ุงูุฃุฏุงุก ูุงูุฑุณูู ุงููุชุญุฑูุฉ
        mainLayout.addView(createPerformanceSection());
        mainLayout.addView(createSectionSpacer());
        
        // ูุณู ุงููุบุฉ ูุงูููุทูุฉ
        mainLayout.addView(createLanguageSection());
        mainLayout.addView(createSectionSpacer());
        
        // ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช
        mainLayout.addView(createActionButtons());
        
        return mainLayout;
    }

    /**
     * ุฅูุดุงุก ุนููุงู ูุฑุญุจ ููุตูุญุฉ ูุดุฑุญ ุงูุบุฑุถ ูู ุงูุฅุนุฏุงุฏุงุช
     */
    private TextView createPageTitle() {
        TextView titleText = new TextView(requireContext());
        titleText.setText("โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู\n\nุฎุตุต ุชุฌุฑุจุชู ูุน ุชุทุจูู OneUI ุญุณุจ ุชูุถููุงุชู ุงูุดุฎุตูุฉ");
        titleText.setTextSize(18);
        titleText.setTextColor(ONEUI_ON_SURFACE);
        titleText.setLineSpacing(dpToPx(4), 1.3f);
        titleText.setPadding(0, 0, 0, dpToPx(16));
        
        return titleText;
    }

    /**
     * ุฅูุดุงุก ูุณู ุฅุนุฏุงุฏุงุช ุงูุนุฑุถ ูุงููุธูุฑ
     * ูุชุถูู ุฎูุงุฑุงุช ุงููุถุน ุงูุฏุงูู ูุชุฎุตูุตุงุช ุงูุจุตุฑูุฉ
     */
    private LinearLayout createDisplaySection() {
        LinearLayout section = createSectionContainer("๐จ ุงูุนุฑุถ ูุงููุธูุฑ");
        
        // ุชุจุฏูู ุงููุถุน ุงูุฏุงูู ูุน ุดุฑุญ ููุตู
        LinearLayout darkModeRow = createSettingRow(
            "ุงููุถุน ุงูุฏุงูู", 
            "ูููู ุฅุฌูุงุฏ ุงูุนูู ูู ุงูุฅุถุงุกุฉ ุงูููุฎูุถุฉ ููููุฑ ุงูุจุทุงุฑูุฉ ุนูู ุดุงุดุงุช OLED");
        
        darkModeSwitch = new Switch(requireContext());
        darkModeSwitch.setLayoutParams(createSwitchLayoutParams());
        darkModeSwitch.setOnCheckedChangeListener((buttonView, isChecked) -> {
            handleDarkModeToggle(isChecked);
        });
        
        darkModeRow.addView(darkModeSwitch);
        section.addView(darkModeRow);
        
        return section;
    }

    /**
     * ุฅูุดุงุก ูุณู ุฅุนุฏุงุฏุงุช ุงูุตูุช ูุงูุฅุดุนุงุฑุงุช
     * ูููุฑ ุชุญููุงู ุฏูููุงู ูู ูุณุชูู ุงูุตูุช ูุฃููุงุน ุงูุฅุดุนุงุฑุงุช
     */
    private LinearLayout createSoundSection() {
        LinearLayout section = createSectionContainer("๐ ุงูุตูุช ูุงูุฅุดุนุงุฑุงุช");
        
        // ุชุจุฏูู ุงูุฅุดุนุงุฑุงุช
        LinearLayout notificationRow = createSettingRow(
            "ุชูุนูู ุงูุฅุดุนุงุฑุงุช", 
            "ุงูุณูุงุญ ุจุนุฑุถ ุฅุดุนุงุฑุงุช ุงูุชุทุจูู ูุงูุชุญุฏูุซุงุช ุงููููุฉ");
        
        notificationSwitch = new Switch(requireContext());
        notificationSwitch.setLayoutParams(createSwitchLayoutParams());
        notificationSwitch.setOnCheckedChangeListener((buttonView, isChecked) -> {
            handleNotificationToggle(isChecked);
        });
        
        notificationRow.addView(notificationSwitch);
        section.addView(notificationRow);
        
        // ูุคุดุฑ ูุณุชูู ุงูุตูุช ูุน ูุต ุฏููุงูููู
        section.addView(createVolumeControl());
        
        return section;
    }

    /**
     * ุฅูุดุงุก ูุณู ุฅุนุฏุงุฏุงุช ุงูุฃุฏุงุก ูุงูุฑุณูู ุงููุชุญุฑูุฉ
     * ูุณูุญ ุจุชุฎุตูุต ุณุฑุนุฉ ุงูุงูุชูุงูุงุช ูุงูุชุฃุซูุฑุงุช ุงูุจุตุฑูุฉ
     */
    private LinearLayout createPerformanceSection() {
        LinearLayout section = createSectionContainer("โก ุงูุฃุฏุงุก ูุงูุฑุณูู ุงููุชุญุฑูุฉ");
        
        // ูุคุดุฑ ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ
        section.addView(createAnimationSpeedControl());
        
        return section;
    }

    /**
     * ุฅูุดุงุก ุนูุตุฑ ุชุญูู ูุณุชูู ุงูุตูุช ูุน ูุคุดุฑ ูููุฉ ุฏููุงูููู
     * ูุณุชุฎุฏู SeekBar ุงูุนุงุฏู ูุน ุชุตููู OneUI
     */
    private LinearLayout createVolumeControl() {
        LinearLayout container = new LinearLayout(requireContext());
        container.setOrientation(LinearLayout.VERTICAL);
        container.setPadding(0, dpToPx(16), 0, dpToPx(8));
        
        // ุนููุงู ูุดุฑุญ ุนูุตุฑ ุงูุชุญูู
        TextView volumeLabel = new TextView(requireContext());
        volumeLabel.setText("ูุณุชูู ุงูุตูุช");
        volumeLabel.setTextSize(16);
        volumeLabel.setTextColor(ONEUI_ON_SURFACE);
        volumeLabel.setTypeface(null, android.graphics.Typeface.BOLD);
        
        TextView volumeDescription = new TextView(requireContext());
        volumeDescription.setText("ุชุญูู ูู ูุณุชูู ุฃุตูุงุช ุงูุชุทุจูู ูุงูุชูุจููุงุช");
        volumeDescription.setTextSize(14);
        volumeDescription.setTextColor(Color.GRAY);
        volumeDescription.setPadding(0, dpToPx(2), 0, dpToPx(8));
        
        // ุฅูุดุงุก SeekBar ููุชุญูู ูู ุงูุตูุช
        volumeSeekBar = new SeekBar(requireContext());
        volumeSeekBar.setMax(100);
        volumeSeekBar.setProgress(50); // ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
        volumeSeekBar.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        
        // ูุต ุนุฑุถ ุงููููุฉ ุงูุญุงููุฉ
        volumeValueText = new TextView(requireContext());
        volumeValueText.setText("50%");
        volumeValueText.setTextSize(14);
        volumeValueText.setTextColor(ONEUI_BLUE);
        volumeValueText.setGravity(android.view.Gravity.CENTER);
        volumeValueText.setPadding(0, dpToPx(4), 0, 0);
        
        // ูุณุชูุน ุชุบููุฑ ุงููููุฉ ูุน ุชุญุฏูุซ ููุฑู ูููุต
        volumeSeekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                if (fromUser) {
                    volumeValueText.setText(progress + "%");
                    saveVolumeSettings(progress);
                }
            }
            
            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {
                // ูููู ุฅุถุงูุฉ ุชุฃุซูุฑุงุช ุจุตุฑูุฉ ุนูุฏ ุจุฏุก ุงูุณุญุจ
            }
            
            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {
                showMessage("ุชู ุชุนุฏูู ูุณุชูู ุงูุตูุช ุฅูู " + seekBar.getProgress() + "%");
            }
        });
        
        container.addView(volumeLabel);
        container.addView(volumeDescription);
        container.addView(volumeSeekBar);
        container.addView(volumeValueText);
        
        return container;
    }

    /**
     * ุฅูุดุงุก ุนูุตุฑ ุชุญูู ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ
     * ูุณูุญ ูููุณุชุฎุฏู ุจุชุฎุตูุต ุณุฑุนุฉ ุงูุชูุงูุงุช ุงููุงุฌูุฉ ุญุณุจ ุชูุถููู
     */
    private LinearLayout createAnimationSpeedControl() {
        LinearLayout container = new LinearLayout(requireContext());
        container.setOrientation(LinearLayout.VERTICAL);
        container.setPadding(0, dpToPx(16), 0, dpToPx(8));
        
        TextView animationLabel = new TextView(requireContext());
        animationLabel.setText("ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ");
        animationLabel.setTextSize(16);
        animationLabel.setTextColor(ONEUI_ON_SURFACE);
        animationLabel.setTypeface(null, android.graphics.Typeface.BOLD);
        
        TextView animationDescription = new TextView(requireContext());
        animationDescription.setText("ุชุญูู ูู ุณุฑุนุฉ ุงูุชูุงูุงุช ุงููุงุฌูุฉ ูุงูุชุฃุซูุฑุงุช ุงูุจุตุฑูุฉ");
        animationDescription.setTextSize(14);
        animationDescription.setTextColor(Color.GRAY);
        animationDescription.setPadding(0, dpToPx(2), 0, dpToPx(8));
        
        animationSeekBar = new SeekBar(requireContext());
        animationSeekBar.setMax(200); // ูู 0% ุฅูู 200%
        animationSeekBar.setProgress(100); // ุงูุณุฑุนุฉ ุงูุนุงุฏูุฉ ูุงูุชุฑุงุถู
        animationSeekBar.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        
        animationValueText = new TextView(requireContext());
        animationValueText.setText("ุนุงุฏู (100%)");
        animationValueText.setTextSize(14);
        animationValueText.setTextColor(ONEUI_BLUE);
        animationValueText.setGravity(android.view.Gravity.CENTER);
        animationValueText.setPadding(0, dpToPx(4), 0, 0);
        
        animationSeekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                if (fromUser) {
                    updateAnimationSpeedText(progress);
                    saveAnimationSettings(progress);
                }
            }
            
            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {}
            
            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {
                String speedText = getAnimationSpeedDescription(seekBar.getProgress());
                showMessage("ุชู ุชุนุฏูู ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ ุฅูู " + speedText);
            }
        });
        
        container.addView(animationLabel);
        container.addView(animationDescription);
        container.addView(animationSeekBar);
        container.addView(animationValueText);
        
        return container;
    }

    /**
     * ุฅูุดุงุก ูุณู ุฅุนุฏุงุฏุงุช ุงููุบุฉ ูุงูููุทูุฉ
     * ูููุฑ ุฎูุงุฑุงุช ุชุบููุฑ ูุบุฉ ุงูุชุทุจูู ูุชูุถููุงุช ุงูููุทูุฉ
     */
    private LinearLayout createLanguageSection() {
        LinearLayout section = createSectionContainer("๐ ุงููุบุฉ ูุงูููุทูุฉ");
        
        // ุฒุฑ ุชุบููุฑ ุงููุบุฉ ูุน ูุนูููุงุช ุงููุบุฉ ุงูุญุงููุฉ
        Button languageButton = createActionButton(
            "ุชุบููุฑ ุงููุบุฉ", 
            "ุงูุนุฑุจูุฉ (ุงูุงูุชุฑุงุถู)");
        languageButton.setOnClickListener(v -> showLanguageOptions());
        section.addView(languageButton);
        
        // ุฒุฑ ุฅุนุฏุงุฏุงุช ุงูููุทูุฉ
        Button regionButton = createActionButton(
            "ุฅุนุฏุงุฏุงุช ุงูููุทูุฉ", 
            "ุชุฎุตูุต ุชูุณูู ุงูุชุงุฑูุฎ ูุงูุฃุฑูุงู");
        regionButton.setOnClickListener(v -> showRegionSettings());
        section.addView(regionButton);
        
        return section;
    }

    /**
     * ุฅูุดุงุก ูุฌููุนุฉ ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุงููุชูุฏูุฉ
     * ุชุชุถูู ุฎูุงุฑุงุช ุฅุนุงุฏุฉ ุงูุชุนููู ูุงููุณุฎ ุงูุงุญุชูุงุทู
     */
    private LinearLayout createActionButtons() {
        LinearLayout section = createSectionContainer("๐ง ุฅุฌุฑุงุกุงุช ูุชูุฏูุฉ");
        
        // ุฒุฑ ุญูุธ ุงูุฅุนุฏุงุฏุงุช
        Button saveButton = createPrimaryActionButton("ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช");
        saveButton.setOnClickListener(v -> saveAllSettings());
        section.addView(saveButton);
        
        section.addView(createButtonSpacer());
        
        // ุฒุฑ ุฅุนุงุฏุฉ ุชุนููู ุงูุฅุนุฏุงุฏุงุช
        Button resetButton = createSecondaryActionButton("ุฅุนุงุฏุฉ ุชุนููู ููุงูุชุฑุงุถู");
        resetButton.setOnClickListener(v -> resetToDefaultSettings());
        section.addView(resetButton);
        
        return section;
    }

    /**
     * ุฅูุดุงุก ุญุงููุฉ ูุณู ูุน ุนููุงู ููุณู
     * ูููุฑ ุชุฎุทูุทุงู ููุญุฏุงู ูุฌููุน ุฃูุณุงู ุงูุฅุนุฏุงุฏุงุช
     */
    private LinearLayout createSectionContainer(String title) {
        LinearLayout section = new LinearLayout(requireContext());
        section.setOrientation(LinearLayout.VERTICAL);
        section.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        section.setPadding(dpToPx(12), dpToPx(12), dpToPx(12), dpToPx(12));
        section.setBackgroundColor(ONEUI_SURFACE);
        
        // ุนููุงู ุงููุณู
        TextView sectionTitle = new TextView(requireContext());
        sectionTitle.setText(title);
        sectionTitle.setTextSize(18);
        sectionTitle.setTextColor(ONEUI_BLUE);
        sectionTitle.setTypeface(null, android.graphics.Typeface.BOLD);
        sectionTitle.setPadding(0, 0, 0, dpToPx(12));
        
        section.addView(sectionTitle);
        return section;
    }

    /**
     * ุฅูุดุงุก ุตู ุฅุนุฏุงุฏ ูุน ุนููุงู ููุตู
     * ูููุฑ ุชุฎุทูุทุงู ููุญุฏุงู ููุฅุนุฏุงุฏุงุช ุงูุชู ุชุญุชูู ุนูู ููุงุชูุญ ุชุจุฏูู
     */
    private LinearLayout createSettingRow(String title, String description) {
        LinearLayout row = new LinearLayout(requireContext());
        row.setOrientation(LinearLayout.HORIZONTAL);
        row.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        row.setPadding(0, dpToPx(8), 0, dpToPx(8));
        row.setGravity(android.view.Gravity.CENTER_VERTICAL);
        
        // ุญุงููุฉ ุงููุตูุต
        LinearLayout textContainer = new LinearLayout(requireContext());
        textContainer.setOrientation(LinearLayout.VERTICAL);
        textContainer.setLayoutParams(new LinearLayout.LayoutParams(
            0, ViewGroup.LayoutParams.WRAP_CONTENT, 1.0f));
        
        TextView titleText = new TextView(requireContext());
        titleText.setText(title);
        titleText.setTextSize(16);
        titleText.setTextColor(ONEUI_ON_SURFACE);
        titleText.setTypeface(null, android.graphics.Typeface.BOLD);
        
        TextView descText = new TextView(requireContext());
        descText.setText(description);
        descText.setTextSize(14);
        descText.setTextColor(Color.GRAY);
        descText.setPadding(0, dpToPx(2), 0, 0);
        
        textContainer.addView(titleText);
        textContainer.addView(descText);
        row.addView(textContainer);
        
        return row;
    }

    /**
     * ูุนุงูุฌุฉ ุชุจุฏูู ุงููุถุน ุงูุฏุงูู ูุน ุญูุธ ุงูุฅุนุฏุงุฏ ูุชุทุจูู ุงูุชุบููุฑ ููุฑูุงู
     */
    private void handleDarkModeToggle(boolean isEnabled) {
        // ุญูุธ ุงูุฅุนุฏุงุฏ ูู SharedPreferences
        sharedPrefs.edit().putBoolean(KEY_DARK_MODE, isEnabled).apply();
        
        // ุชุทุจูู ุงูุชุบููุฑ ุนูู ุงูุชุทุจูู ููุฑูุงู
        if (isEnabled) {
            AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES);
            showMessage("ุชู ุชูุนูู ุงููุถุน ุงูุฏุงูู - ูููุฑ ุทุงูุฉ ุงูุจุทุงุฑูุฉ ููููู ุฅุฌูุงุฏ ุงูุนูู");
        } else {
            AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);
            showMessage("ุชู ุชูุนูู ุงููุถุน ุงููุงุชุญ - ูุซุงูู ููุงุณุชุฎุฏุงู ูู ุงูุฅุถุงุกุฉ ุงูุฌูุฏุฉ");
        }
    }

    /**
     * ูุนุงูุฌุฉ ุชุจุฏูู ุงูุฅุดุนุงุฑุงุช ูุน ุดุฑุญ ุชุฃุซูุฑ ุงูุชุบููุฑ
     */
    private void handleNotificationToggle(boolean isEnabled) {
        sharedPrefs.edit().putBoolean(KEY_NOTIFICATIONS, isEnabled).apply();
        
        String message = isEnabled ? 
            "ุชู ุชูุนูู ุงูุฅุดุนุงุฑุงุช - ุณุชุตูู ุงูุชุญุฏูุซุงุช ุงููููุฉ" : 
            "ุชู ุฅููุงู ุงูุฅุดุนุงุฑุงุช - ูู ุชุตูู ุฃู ุชูุจููุงุช ูู ุงูุชุทุจูู";
        showMessage(message);
    }

    /**
     * ุญูุธ ุฅุนุฏุงุฏุงุช ูุณุชูู ุงูุตูุช
     */
    private void saveVolumeSettings(int volume) {
        sharedPrefs.edit().putInt(KEY_SOUND_VOLUME, volume).apply();
    }

    /**
     * ุญูุธ ุฅุนุฏุงุฏุงุช ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ
     */
    private void saveAnimationSettings(int speed) {
        sharedPrefs.edit().putInt(KEY_ANIMATION_SPEED, speed).apply();
    }

    /**
     * ุชุญุฏูุซ ูุต ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ ุจูุงุกู ุนูู ุงููููุฉ ุงููุญุฏุฏุฉ
     */
    private void updateAnimationSpeedText(int progress) {
        String speedText;
        if (progress <= 25) {
            speedText = "ุจุทูุก ุฌุฏุงู (" + progress + "%)";
        } else if (progress <= 75) {
            speedText = "ุจุทูุก (" + progress + "%)";
        } else if (progress <= 125) {
            speedText = "ุนุงุฏู (" + progress + "%)";
        } else if (progress <= 175) {
            speedText = "ุณุฑูุน (" + progress + "%)";
        } else {
            speedText = "ุณุฑูุน ุฌุฏุงู (" + progress + "%)";
        }
        animationValueText.setText(speedText);
    }

    /**
     * ุงูุญุตูู ุนูู ูุตู ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ
     */
    private String getAnimationSpeedDescription(int progress) {
        if (progress <= 25) return "ุจุทูุก ุฌุฏุงู";
        if (progress <= 75) return "ุจุทูุก";
        if (progress <= 125) return "ุนุงุฏู";
        if (progress <= 175) return "ุณุฑูุน";
        return "ุณุฑูุน ุฌุฏุงู";
    }

    /**
     * ุชุญููู ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ ูุชุทุจูููุง ุนูู ุงููุงุฌูุฉ
     */
    private void loadSavedSettings() {
        // ุชุญููู ุฅุนุฏุงุฏ ุงููุถุน ุงูุฏุงูู
        boolean darkMode = sharedPrefs.getBoolean(KEY_DARK_MODE, false);
        if (darkModeSwitch != null) {
            darkModeSwitch.setChecked(darkMode);
        }
        
        // ุชุญููู ุฅุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช
        boolean notifications = sharedPrefs.getBoolean(KEY_NOTIFICATIONS, true);
        if (notificationSwitch != null) {
            notificationSwitch.setChecked(notifications);
        }
        
        // ุชุญููู ูุณุชูู ุงูุตูุช
        int volume = sharedPrefs.getInt(KEY_SOUND_VOLUME, 50);
        if (volumeSeekBar != null && volumeValueText != null) {
            volumeSeekBar.setProgress(volume);
            volumeValueText.setText(volume + "%");
        }
        
        // ุชุญููู ุณุฑุนุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ
        int animationSpeed = sharedPrefs.getInt(KEY_ANIMATION_SPEED, 100);
        if (animationSeekBar != null && animationValueText != null) {
            animationSeekBar.setProgress(animationSpeed);
            updateAnimationSpeedText(animationSpeed);
        }
    }

    /**
     * ุนุฑุถ ุฎูุงุฑุงุช ุงููุบุฉ ุงููุชุงุญุฉ
     */
    private void showLanguageOptions() {
        String[] languages = {"ุงูุนุฑุจูุฉ", "English", "Franรงais", "Deutsch", "ํ๊ตญ์ด", "ๆฅๆฌ่ช"};
        String message = "ุงููุบุงุช ุงููุชุงุญุฉ:\n";
        for (int i = 0; i < languages.length; i++) {
            message += (i + 1) + ". " + languages[i] + "\n";
        }
        message += "\nููุฒุฉ ุชุบููุฑ ุงููุบุฉ ุณุชููู ูุชุงุญุฉ ูู ุงูุชุญุฏูุซ ุงููุงุฏู";
        
        Toast.makeText(getContext(), message, Toast.LENGTH_LONG).show();
    }

    /**
     * ุนุฑุถ ุฅุนุฏุงุฏุงุช ุงูููุทูุฉ
     */
    private void showRegionSettings() {
        showMessage("ุฅุนุฏุงุฏุงุช ุงูููุทูุฉ: ุชูุณูู ุงูุชุงุฑูุฎ ุงููุฌุฑู/ุงููููุงุฏูุ ูุธุงู ุงูุฃุฑูุงูุ ุงุชุฌุงู ุงููุต\nููุฏ ุงูุชุทููุฑ ูู ุงูุฅุตุฏุงุฑ ุงููุงุฏู");
    }

    /**
     * ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ
     */
    private void saveAllSettings() {
        SharedPreferences.Editor editor = sharedPrefs.edit();
        
        if (darkModeSwitch != null) {
            editor.putBoolean(KEY_DARK_MODE, darkModeSwitch.isChecked());
        }
        if (notificationSwitch != null) {
            editor.putBoolean(KEY_NOTIFICATIONS, notificationSwitch.isChecked());
        }
        if (volumeSeekBar != null) {
            editor.putInt(KEY_SOUND_VOLUME, volumeSeekBar.getProgress());
        }
        if (animationSeekBar != null) {
            editor.putInt(KEY_ANIMATION_SPEED, animationSeekBar.getProgress());
        }
        
        editor.apply();
        showMessage("โ ุชู ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ!");
    }

    /**
     * ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุฅูู ุงูููู ุงูุงูุชุฑุงุถูุฉ
     */
    private void resetToDefaultSettings() {
        // ุฅุนุงุฏุฉ ุชุนููู ุงููุงุฌูุฉ ููููู ุงูุงูุชุฑุงุถูุฉ
        if (darkModeSwitch != null) darkModeSwitch.setChecked(false);
        if (notificationSwitch != null) notificationSwitch.setChecked(true);
        if (volumeSeekBar != null && volumeValueText != null) {
            volumeSeekBar.setProgress(50);
            volumeValueText.setText("50%");
        }
        if (animationSeekBar != null && animationValueText != null) {
            animationSeekBar.setProgress(100);
            updateAnimationSpeedText(100);
        }
        
        // ุญูุธ ุงูููู ุงูุงูุชุฑุงุถูุฉ
        SharedPreferences.Editor editor = sharedPrefs.edit();
        editor.putBoolean(KEY_DARK_MODE, false);
        editor.putBoolean(KEY_NOTIFICATIONS, true);
        editor.putInt(KEY_SOUND_VOLUME, 50);
        editor.putInt(KEY_ANIMATION_SPEED, 100);
        editor.apply();
        
        // ุชุทุจูู ุงููุถุน ุงููุงุชุญ
        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);
        
        showMessage("๐ ุชู ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุฅูู ุงููุถุน ุงูุงูุชุฑุงุถู");
    }

    /**
     * ุฅูุดุงุก ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุงููุฎุชููุฉ ุจุชุตุงููู ูุชูุงูุฒุฉ
     */
    private Button createActionButton(String title, String subtitle) {
        Button button = new Button(requireContext());
        button.setText(title + "\n" + subtitle);
        button.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        button.setAllCaps(false);
        button.setTextSize(14);
        button.setPadding(dpToPx(16), dpToPx(16), dpToPx(16), dpToPx(16));
        button.setBackgroundColor(Color.parseColor("#E3F2FD"));
        button.setTextColor(ONEUI_BLUE);
        
        return button;
    }

    private Button createPrimaryActionButton(String text) {
        Button button = new Button(requireContext());
        button.setText(text);
        button.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        button.setAllCaps(false);
        button.setTextSize(16);
        button.setTypeface(null, android.graphics.Typeface.BOLD);
        button.setPadding(dpToPx(16), dpToPx(16), dpToPx(16), dpToPx(16));
        button.setBackgroundColor(ONEUI_BLUE);
        button.setTextColor(Color.WHITE);
        
        return button;
    }

    private Button createSecondaryActionButton(String text) {
        Button button = new Button(requireContext());
        button.setText(text);
        button.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT));
        button.setAllCaps(false);
        button.setTextSize(14);
        button.setPadding(dpToPx(16), dpToPx(12), dpToPx(16), dpToPx(12));
        button.setBackgroundColor(Color.parseColor("#FFEBEE"));
        button.setTextColor(Color.parseColor("#C62828"));
        
        return button;
    }

    /**
     * ุฅูุดุงุก ูุนุงููุงุช ุชุฎุทูุท ููุญุฏุฉ ูููุงุชูุญ ุงูุชุจุฏูู
     */
    private LinearLayout.LayoutParams createSwitchLayoutParams() {
        return new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.WRAP_CONTENT, 
            ViewGroup.LayoutParams.WRAP_CONTENT);
    }

    /**
     * ุฅูุดุงุก ูุณุงุญุฉ ุจูู ุงูุฃูุณุงู ูุชุญุณูู ุงูุชุฎุทูุท ุงูุจุตุฑู
     */
    private View createSectionSpacer() {
        View spacer = new View(requireContext());
        spacer.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, dpToPx(16)));
        return spacer;
    }

    private View createButtonSpacer() {
        View spacer = new View(requireContext());
        spacer.setLayoutParams(new LinearLayout.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT, dpToPx(8)));
        return spacer;
    }

    /**
     * ุชุญููู ูุญุฏุงุช dp ุฅูู pixels ููุญุตูู ุนูู ุฃุจุนุงุฏ ุฏูููุฉ
     */
    private int dpToPx(int dp) {
        float density = requireContext().getResources().getDisplayMetrics().density;
        return Math.round(dp * density);
    }

    /**
     * ุนุฑุถ ุฑุณุงุฆู ุชุฃููุฏ ูุชูุถูุญูุฉ ูููุณุชุฎุฏู
     */
    private void showMessage(String message) {
        if (getContext() != null) {
            Toast.makeText(getContext(), message, Toast.LENGTH_LONG).show();
        }
    }
    }
